<div>
    <form id="chat-{{.ChatId}}-msg-form"
        hx-post="/message" 
        hx-trigger="submit" 
        hx-target=".message-list" 
        hx-swap="beforeend"
        hx-include="[name='chatid'],[name='msg']"
        class="flex mt-auto border-2 rounded border-emerald-400"
    >
        <input type="hidden" name="chatid" value="{{ .ChatId }}">
        <input id="chat-{{.ChatId}}-msg-text-input" type="text" name="msg" 
            placeholder="type message" 
            title="enter to send"
            class="w-full
            text-center
            rounded-md
            bg-gradient-to-br from-green-800 to-indigo-800
            text-gray-400
            shadow shadow-zinc-700
            hover:shadow-lg hover:shadow-zinc-500">
        <button type="submit" class="hidden">
            Send Message
        </button>
    </form>
    <script>
        // TODO clear any active quotes
        document.body.addEventListener('htmx:afterSwap', event => {
            const newMsgText = document.getElementById('chat-{{.ChatId}}-msg-text-input');
            if (newMsgText) {
                newMsgText.value = '';
            }
           
            if (event.target.id !== 'chat-{{.ChatId}}-msg-form') {
                setTimeout(() => {
                    console.log('removing all previous quotes from chatId[{{ .ChatId }}]');
                    const quotes = document.querySelectorAll(`.quote-chat-message`);
                    console.log('removing previous quotes in chat[{{ .ChatId }}]');
                    for (i = 0; i < quotes.length; i++) {
                        quotes[i].remove();
                    }
                }, 100);     
            }
        });
    </script>
</div>